!function(){var a=/xyz/.test(function(){})?/\b_super\b/:/.*/;this.Class=function(){},this.Class.extend=function(b){function f(){"function"==typeof this.ctor&&this.ctor.apply(this,arguments)}var e,c=this.prototype,d=new this;for(e in b)d[e]="function"==typeof b[e]&&"function"==typeof c[e]&&a.test(b[e])?function(a,b){return function(){var e,d=this._super;return this._super=c[a],e=b.apply(this,arguments),this._super=d,e}}(e,b[e]):b[e];return f.prototype=d,f.prototype.constructor=Class,f.extend=arguments.callee,f}}(),function(){"use strict";window.WebApp=Class.extend({name:"",resources:{},htmls:{},site:null,ctor:function(b,c){var d,e;for(d in c)this[d]=c[d];this.resources=b,this.site=new a(this.name,this.resources.htmls),e=this,setTimeout(function(){e.loadResources()},0)},start:function(){},__start:function(){this.start(),this.start=function(){}},loadResources:function(){function j(){a.onResLoadUpdate(100*(++g/f),g,f),g==f&&a.onResLoadComplete()}var h,i,a=this,b=this.resources.styles,c=this.resources.scripts,d=this.resources.htmls,e=this.resources.images,f=0,g=0;if(this.onResLoadStart(),b&&(f+=b.length),c&&(f+=c.length),d){h=[];for(i in d)h.push(d[i]);f+=h.length,d=h}e&&(f+=e.length),b&&b.length&&new WebApp.StyleLoader(b,{onUpdate:j}),c&&c.length&&new WebApp.ScriptLoader(c,{onUpdate:j}),d&&d.length&&new WebApp.HtmlLoader(d,{onUpdate:j}),e&&e.length&&new WebApp.HtmlLoader(e,{onUpdate:j}),f||this.onResLoadComplete()},onResLoadStart:function(){this.resources.progress&&this.resources.progress.onStart()},onResLoadUpdate:function(a,b,c){this.resources.progress&&this.resources.progress.onUpdate(a,b,c)},onResLoadComplete:function(){this.resources.progress&&this.resources.progress.onComplete(),this.__start()},debug:!1,log:function(){this.debug&&console.log.apply(console,arguments)}});var a=Class.extend({name:null,view:null,Pages:{},htmls:{},_pages:{},ctor:function(a,b){this.name=a,this.htmls=b||{},this.view=$("<div id='site_"+a+"'>").appendTo(document.body)},getPage:function(a){return this._pages[a]},addPage:function(a,b){var c=this;this.getPage(a)?b&&b(this.getPage(a)):this.__loadPage(a,function(a){c.view.append(a.view),a.onAdded(),b&&b(a)})},removePage:function(a){var b=this._pages[a];b&&(b.onRemoved(),b.view.remove(),delete this._pages[a])},__loadPage:function(a,b){var c=this,d=this.htmls[a];new WebApp.HtmlLoader(d,function(e){var f=c.Pages[a]||WebApp.Page;b(c._pages[a]=new f(a,$(e[d])))})},registerPage:function(a,b){this.Pages[a]=b}});WebApp.Page=Class.extend({name:null,view:null,ctor:function(a,b){this.name=a,this.view=b},onAdded:function(){this.initView(),this.initEvent()},onRemoved:function(){},initView:function(){},initEvent:function(){}})}(),function(){"use strict";window.WebApp=window.WebApp||{},WebApp.Progress=Class.extend({onStart:function(){},onUpdate:function(){},onError:function(a){window.console&&console.log(a)},onComplete:function(){},ctor:function(a){for(var b in a)this[b]=a[b]}})}(),function(){"use strict";var Htmls,Jsons;window.WebApp=window.WebApp||{},WebApp.Loader=Class.extend({progress:null,files:null,fileQuantity:0,fileCounter:0,filePos:0,thread:16,threadCounter:0,contents:null,prefix:"resource/",ctor:function(a){this.contents={},a&&this.load.apply(this,arguments)},load:function(a,b,c){return"string"==typeof a&&(a=[a]),"function"==typeof b&&(b={onComplete:b}),this.progress=new WebApp.Progress(b),a&&a.length?(this.files=a,this.fileQuantity=a.length,this.thread=c||this.thread,this.loadFiles(),void 0):(b.onError("no files to load"),void 0)},loadFiles:function(){var a,b;for(this.progress.onStart(),a=this.threadCounter;a<this.thread&&(b=this.files[this.filePos++],b);++a)this.loadFile(b)},prefixUrl:function(a){return/^http+(s{0,1}):\/\//.test(a)||/^.{1,2}\//.test(a)||(a=this.prefix+a),a},onLoad:function(){--this.threadCounter,++this.fileCounter,this.progress.onUpdate(Math.floor(100*this.fileCounter/this.fileQuantity),this.fileCounter,this.fileQuantity),this.fileCounter==this.fileQuantity?this.progress.onComplete(this.contents):this.loadFiles()},loadFile:function(){},onSuccesss:function(a,b){this.saveFile(a,b),this.contents[a]=b},onError:function(a){this.progress.onError("file load with error: "+a)},saveFile:function(){}}),WebApp.ImageLoader=WebApp.Loader.extend({thread:16,loadFile:function(a){var b,c;this._super(a),b=this,c=new window.Image,c.onload=function(){b.onSuccesss(a,c),b.onLoad()},c.onerror=function(){b.onError(a),b.onLoad()},c.src=this.prefixUrl(url)}}),WebApp.TextLoader=WebApp.Loader.extend({thread:16,dataType:"text",loadFile:function(a){this._super(a);var b=this;$.ajax({url:this.prefixUrl(a),async:!1,dataType:this.dataType,success:function(c){b.onSuccesss(a,c),b.onLoad()},error:function(){b.onError(a),b.onLoad()}})}}),Htmls={},WebApp.HtmlLoader=WebApp.TextLoader.extend({thread:16,dataType:"html",loadFile:function(a){Htmls[a]?(this.contents[a]=Htmls[a],this.onLoad()):this._super(a)},saveFile:function(a,b){Htmls[a]=b}}),WebApp.ScriptLoader=WebApp.TextLoader.extend({thread:16,dataType:"script",onSuccesss:function(file,text){var ret,self=this;this._super(file,text);try{ret=eval(text),this.saveFile(file,text),this.contents[file]=ret}catch(e){throw self.onError(file),new Error(e)}}}),Jsons={},WebApp.JsonLoader=WebApp.TextLoader.extend({thread:16,dataType:"json",loadFile:function(a){Jsons[a]?(this.contents[a]=JSON.parse(Jsons[a]),this.onLoad()):this._super(a)},onSuccesss:function(a,b){var d,c=this;try{d=JSON.parse(b),this.saveFile(a,b),this.contents[a]=d}catch(e){c.onError(a)}},saveFile:function(a,b){Jsons[a]=b}}),WebApp.StyleLoader=WebApp.Loader.extend({thread:16,dataType:"text",loadFile:function(a){var b,c;this._super(a),b=this,c=document.createElement("link"),c.rel="stylesheet",c.rev="stylesheet",c.type="text/css",c.media="screen",c.onload=function(){b.onSuccesss(a,c),b.onLoad()},c.onerror=function(){b.onError(a),b.onLoad()},c.href=this.prefixUrl(a),document.getElementsByTagName("head")[0].appendChild(c)}})}();